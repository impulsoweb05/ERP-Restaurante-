<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>Widget Chat - Restaurante</title>
  <style>
    /**
     * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     * RESTAURANT CHAT WIDGET - EMBEDDABLE STYLES
     * Self-contained CSS - No external dependencies
     * Primary Color: #FF6B35
     * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     */

    :root {
      --widget-primary: #FF6B35;
      --widget-primary-dark: #E55A2B;
      --widget-bg: #FFFFFF;
      --widget-text: #333333;
      --widget-text-light: #666666;
      --widget-border: #E0E0E0;
      --widget-shadow: rgba(0, 0, 0, 0.1);
      --widget-shadow-dark: rgba(0, 0, 0, 0.2);
      --widget-success: #4CAF50;
      --widget-error: #F44336;
      --widget-bot-bg: #F5F5F5;
      --widget-user-bg: var(--widget-primary);
    }

    /* Reset for widget elements */
    .restaurant-chat-widget *,
    .restaurant-chat-widget *::before,
    .restaurant-chat-widget *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       FLOATING BUTTON
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .restaurant-chat-button {
      position: fixed;
      bottom: 20px;
      right: 20px;
      width: 60px;
      height: 60px;
      border-radius: 50%;
      background: var(--widget-primary);
      box-shadow: 0 4px 12px var(--widget-shadow-dark);
      cursor: pointer;
      z-index: 9999;
      transition: all 0.3s ease;
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .restaurant-chat-button:hover {
      transform: scale(1.1);
      background: var(--widget-primary-dark);
    }

    .restaurant-chat-button:focus {
      outline: 2px solid var(--widget-primary);
      outline-offset: 2px;
    }

    .restaurant-chat-button svg {
      width: 28px;
      height: 28px;
      fill: white;
      transition: transform 0.3s ease;
    }

    .restaurant-chat-button.open svg {
      transform: rotate(180deg);
    }

    .restaurant-chat-button-badge {
      position: absolute;
      top: -5px;
      right: -5px;
      background: var(--widget-error);
      color: white;
      font-size: 12px;
      font-weight: bold;
      min-width: 20px;
      height: 20px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 0 6px;
      opacity: 0;
      transform: scale(0);
      transition: all 0.3s ease;
    }

    .restaurant-chat-button-badge.visible {
      opacity: 1;
      transform: scale(1);
    }

    /* Position variants */
    .restaurant-chat-button.bottom-left {
      right: auto;
      left: 20px;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CHAT WINDOW
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .restaurant-chat-window {
      position: fixed;
      bottom: 90px;
      right: 20px;
      width: 380px;
      height: 600px;
      max-height: calc(100vh - 110px);
      background: var(--widget-bg);
      border-radius: 12px;
      box-shadow: 0 8px 24px var(--widget-shadow-dark);
      display: none;
      flex-direction: column;
      z-index: 9998;
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .restaurant-chat-window.open {
      display: flex;
      animation: slideUp 0.3s ease;
    }

    .restaurant-chat-window.bottom-left {
      right: auto;
      left: 20px;
    }

    @keyframes slideUp {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       CHAT HEADER
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .restaurant-chat-header {
      background: var(--widget-primary);
      color: white;
      padding: 16px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-shrink: 0;
    }

    .restaurant-chat-header-info {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .restaurant-chat-header-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
    }

    .restaurant-chat-header-avatar svg {
      width: 24px;
      height: 24px;
      fill: white;
    }

    .restaurant-chat-header-text h3 {
      font-size: 16px;
      font-weight: 600;
      margin: 0 0 2px 0;
    }

    .restaurant-chat-header-status {
      font-size: 12px;
      opacity: 0.9;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .restaurant-chat-header-status-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--widget-success);
    }

    .restaurant-chat-header-status-dot.offline {
      background: var(--widget-error);
    }

    .restaurant-chat-close-btn {
      background: transparent;
      border: none;
      color: white;
      width: 32px;
      height: 32px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: background 0.2s ease;
    }

    .restaurant-chat-close-btn:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .restaurant-chat-close-btn:focus {
      outline: 2px solid white;
      outline-offset: 2px;
    }

    .restaurant-chat-close-btn svg {
      width: 18px;
      height: 18px;
      fill: currentColor;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MESSAGES AREA
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .restaurant-chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      background: #FAFAFA;
    }

    .restaurant-chat-messages::-webkit-scrollbar {
      width: 6px;
    }

    .restaurant-chat-messages::-webkit-scrollbar-track {
      background: transparent;
    }

    .restaurant-chat-messages::-webkit-scrollbar-thumb {
      background: var(--widget-border);
      border-radius: 3px;
    }

    .restaurant-chat-messages::-webkit-scrollbar-thumb:hover {
      background: #BDBDBD;
    }

    /* Message bubbles */
    .restaurant-chat-message {
      max-width: 85%;
      display: flex;
      flex-direction: column;
      animation: fadeIn 0.3s ease;
    }

    .restaurant-chat-message.bot {
      align-self: flex-start;
    }

    .restaurant-chat-message.user {
      align-self: flex-end;
    }

    .restaurant-chat-message-bubble {
      padding: 12px 16px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.5;
      word-wrap: break-word;
      white-space: pre-wrap;
    }

    .restaurant-chat-message.bot .restaurant-chat-message-bubble {
      background: var(--widget-bg);
      color: var(--widget-text);
      border-bottom-left-radius: 4px;
      box-shadow: 0 1px 2px var(--widget-shadow);
    }

    .restaurant-chat-message.user .restaurant-chat-message-bubble {
      background: var(--widget-primary);
      color: white;
      border-bottom-right-radius: 4px;
    }

    .restaurant-chat-message-timestamp {
      font-size: 11px;
      color: var(--widget-text-light);
      margin-top: 4px;
      padding: 0 4px;
    }

    .restaurant-chat-message.user .restaurant-chat-message-timestamp {
      text-align: right;
    }

    /* Typing indicator */
    .restaurant-chat-typing {
      display: none;
      align-items: center;
      gap: 8px;
      padding: 12px 16px;
      background: var(--widget-bg);
      border-radius: 16px;
      border-bottom-left-radius: 4px;
      max-width: 80px;
      box-shadow: 0 1px 2px var(--widget-shadow);
    }

    .restaurant-chat-typing.visible {
      display: flex;
    }

    .restaurant-chat-typing-dots {
      display: flex;
      gap: 4px;
    }

    .restaurant-chat-typing-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--widget-text-light);
      animation: typingBounce 1.4s infinite ease-in-out;
    }

    .restaurant-chat-typing-dot:nth-child(1) {
      animation-delay: 0s;
    }

    .restaurant-chat-typing-dot:nth-child(2) {
      animation-delay: 0.2s;
    }

    .restaurant-chat-typing-dot:nth-child(3) {
      animation-delay: 0.4s;
    }

    @keyframes typingBounce {
      0%, 60%, 100% {
        transform: translateY(0);
      }
      30% {
        transform: translateY(-4px);
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       INPUT AREA
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    .restaurant-chat-input-area {
      padding: 12px 16px;
      background: var(--widget-bg);
      border-top: 1px solid var(--widget-border);
      display: flex;
      gap: 8px;
      align-items: flex-end;
      flex-shrink: 0;
    }

    .restaurant-chat-input-wrapper {
      flex: 1;
      position: relative;
    }

    .restaurant-chat-input {
      width: 100%;
      padding: 12px 16px;
      border: 1px solid var(--widget-border);
      border-radius: 24px;
      font-size: 14px;
      font-family: inherit;
      resize: none;
      outline: none;
      transition: border-color 0.2s ease, box-shadow 0.2s ease;
      min-height: 44px;
      max-height: 120px;
      line-height: 1.4;
    }

    .restaurant-chat-input:focus {
      border-color: var(--widget-primary);
      box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
    }

    .restaurant-chat-input:disabled {
      background: #F5F5F5;
      cursor: not-allowed;
      opacity: 0.7;
    }

    .restaurant-chat-input::placeholder {
      color: var(--widget-text-light);
    }

    .restaurant-chat-send-btn {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      background: var(--widget-primary);
      border: none;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.2s ease;
      flex-shrink: 0;
    }

    .restaurant-chat-send-btn:hover:not(:disabled) {
      background: var(--widget-primary-dark);
      transform: scale(1.05);
    }

    .restaurant-chat-send-btn:focus {
      outline: 2px solid var(--widget-primary);
      outline-offset: 2px;
    }

    .restaurant-chat-send-btn:disabled {
      background: var(--widget-border);
      cursor: not-allowed;
    }

    .restaurant-chat-send-btn svg {
      width: 20px;
      height: 20px;
      fill: white;
    }

    /* Error message */
    .restaurant-chat-error {
      display: none;
      padding: 8px 12px;
      background: #FFEBEE;
      color: var(--widget-error);
      font-size: 12px;
      border-left: 3px solid var(--widget-error);
      margin: 0 16px;
      border-radius: 0 4px 4px 0;
    }

    .restaurant-chat-error.visible {
      display: block;
      animation: fadeIn 0.2s ease;
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       MOBILE RESPONSIVE - FULLSCREEN
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    @media (max-width: 768px) {
      .restaurant-chat-window {
        bottom: 0;
        right: 0;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        max-height: 100vh;
        border-radius: 0;
      }

      .restaurant-chat-window.bottom-left {
        left: 0;
        right: 0;
      }

      .restaurant-chat-button {
        bottom: 16px;
        right: 16px;
        width: 56px;
        height: 56px;
      }

      .restaurant-chat-button.bottom-left {
        right: auto;
        left: 16px;
      }

      .restaurant-chat-button svg {
        width: 24px;
        height: 24px;
      }

      .restaurant-chat-header {
        padding: 12px 16px;
      }

      .restaurant-chat-input-area {
        padding: 10px 12px;
      }

      .restaurant-chat-messages {
        padding: 12px;
      }
    }

    /* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
       ACCESSIBILITY
       â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */

    @media (prefers-reduced-motion: reduce) {
      .restaurant-chat-window,
      .restaurant-chat-button,
      .restaurant-chat-message,
      .restaurant-chat-typing-dot {
        animation: none;
        transition: none;
      }
    }

    /* High contrast focus states */
    .restaurant-chat-button:focus-visible,
    .restaurant-chat-close-btn:focus-visible,
    .restaurant-chat-send-btn:focus-visible,
    .restaurant-chat-input:focus-visible {
      outline: 3px solid var(--widget-primary);
      outline-offset: 2px;
    }

    /* Screen reader only text */
    .restaurant-chat-sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border: 0;
    }
  </style>
</head>
<body>
  <!-- Widget Chat Container - Injected dynamically by JavaScript -->

  <script>
    /**
     * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     * RESTAURANT CHAT WIDGET - EMBEDDABLE JAVASCRIPT
     * Self-contained JavaScript - No external dependencies
     * State Machine Levels 0-15 with validations
     * â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     */

    (function() {
      'use strict';

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // CONFIGURATION
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      var CONFIG = {
        apiUrl: 'http://localhost:4000/api',
        restaurantName: 'Restaurante',
        primaryColor: '#FF6B35',
        position: 'bottom-right'
      };

      // Storage keys
      var STORAGE_KEYS = {
        SESSION_ID: 'widget_session_id',
        PHONE: 'widget_phone',
        CURRENT_LEVEL: 'widget_current_level',
        CONVERSATION_HISTORY: 'widget_conversation_history',
        LAST_ACTIVITY: 'widget_last_activity'
      };

      // Session timeout (24 hours in milliseconds)
      var SESSION_TIMEOUT = 24 * 60 * 60 * 1000;

      // Order completion cleanup timeout (1 minute)
      var ORDER_COMPLETION_CLEANUP_TIMEOUT = 60000;

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // STATE MACHINE - LEVELS 0-15 WITH VALIDATIONS
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      var LEVELS = {
        0: {
          validation: null,
          placeholder: 'Escribe cualquier cosa para comenzar...',
          errorMsg: null
        },
        1: {
          // Nivel 1: telÃ©fono 10 dÃ­gitos
          validation: function(msg) { return /^\d{10}$/.test(msg); },
          placeholder: 'Ingresa tu telÃ©fono (10 dÃ­gitos)...',
          errorMsg: 'âš ï¸ Debe ser un telÃ©fono de 10 dÃ­gitos'
        },
        2: {
          // Niveles 2-5: nÃºmeros vÃ¡lidos
          validation: function(msg) { return /^[1-9]\d*$/.test(msg); },
          placeholder: 'Elige un nÃºmero...',
          errorMsg: 'âš ï¸ Elige una opciÃ³n vÃ¡lida'
        },
        3: {
          validation: function(msg) { return /^[1-9]\d*$/.test(msg); },
          placeholder: 'Elige un nÃºmero...',
          errorMsg: 'âš ï¸ Elige una opciÃ³n vÃ¡lida'
        },
        4: {
          validation: function(msg) { return /^[1-9]\d*$/.test(msg); },
          placeholder: 'Elige un nÃºmero...',
          errorMsg: 'âš ï¸ Elige una opciÃ³n vÃ¡lida'
        },
        5: {
          // Nivel 5: cantidad 1-20
          validation: function(msg) { 
            return /^[1-9]\d*$/.test(msg) && parseInt(msg, 10) >= 1 && parseInt(msg, 10) <= 20; 
          },
          placeholder: 'Cantidad (1-20)...',
          errorMsg: 'âš ï¸ Cantidad entre 1 y 20'
        },
        6: {
          validation: null,
          placeholder: "Instrucciones especiales o 'no'...",
          errorMsg: null
        },
        7: {
          // Niveles 7,8,12: si/no
          validation: function(msg) { 
            return ['si', 'sÃ­', 'no'].indexOf(msg.toLowerCase().trim()) !== -1; 
          },
          placeholder: "Escribe 'si' o 'no'...",
          errorMsg: "âš ï¸ Responde 'si' o 'no'"
        },
        8: {
          validation: function(msg) { 
            return ['si', 'sÃ­', 'no'].indexOf(msg.toLowerCase().trim()) !== -1; 
          },
          placeholder: "Escribe 'si' o 'no'...",
          errorMsg: "âš ï¸ Responde 'si' o 'no'"
        },
        9: {
          // Nivel 9: direcciÃ³n min 10 chars
          validation: function(msg) { return msg.trim().length >= 10; },
          placeholder: 'Escribe tu direcciÃ³n completa...',
          errorMsg: 'âš ï¸ DirecciÃ³n muy corta (mÃ­nimo 10 caracteres)'
        },
        10: {
          validation: null,
          placeholder: 'Referencias de ubicaciÃ³n...',
          errorMsg: null
        },
        11: {
          // Nivel 11: opciones 1-4
          validation: function(msg) { 
            return ['1', '2', '3', '4'].indexOf(msg.trim()) !== -1; 
          },
          placeholder: 'Elige 1, 2, 3 o 4...',
          errorMsg: 'âš ï¸ OpciÃ³n invÃ¡lida (1, 2, 3 o 4)'
        },
        12: {
          validation: function(msg) { 
            return ['si', 'sÃ­', 'no'].indexOf(msg.toLowerCase().trim()) !== -1; 
          },
          placeholder: "Escribe 'si' o 'no'...",
          errorMsg: "âš ï¸ Responde 'si' o 'no'"
        },
        13: {
          validation: null,
          placeholder: '',
          readonly: true,
          errorMsg: null
        },
        14: {
          validation: null,
          placeholder: 'Escribe tu mensaje...',
          errorMsg: null
        },
        15: {
          validation: null,
          placeholder: 'Escribe tu mensaje...',
          errorMsg: null
        }
      };

      /**
       * Validate input based on current level
       * @param {number} level
       * @param {string} message
       * @returns {{valid: boolean, errorMsg: string|null}}
       */
      function validateInput(level, message) {
        var levelConfig = LEVELS[level];
        
        if (!levelConfig) {
          return { valid: true, errorMsg: null };
        }
        
        if (!levelConfig.validation) {
          return { valid: true, errorMsg: null };
        }
        
        var isValid = levelConfig.validation(message);
        return {
          valid: isValid,
          errorMsg: isValid ? null : levelConfig.errorMsg
        };
      }

      /**
       * Get placeholder for current level
       * @param {number} level
       * @returns {string}
       */
      function getPlaceholder(level) {
        var levelConfig = LEVELS[level];
        return levelConfig ? levelConfig.placeholder : 'Escribe tu mensaje...';
      }

      /**
       * Check if current level is readonly
       * @param {number} level
       * @returns {boolean}
       */
      function isReadonly(level) {
        var levelConfig = LEVELS[level];
        return levelConfig ? !!levelConfig.readonly : false;
      }

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // CHAT API - COMMUNICATION
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      var ChatAPI = {
        /**
         * Send message to backend
         * @param {string} sessionId
         * @param {string} message
         * @param {string|null} phone
         * @returns {Promise}
         */
        sendMessage: function(sessionId, message, phone) {
          var body = {
            session_id: sessionId,
            message: message
          };

          if (phone) {
            body.phone = phone;
          }

          return fetch(CONFIG.apiUrl + '/chat/message', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(body)
          })
          .then(function(response) {
            return response.json().then(function(data) {
              if (!response.ok) {
                return {
                  success: false,
                  error: data.message || 'Error al enviar mensaje'
                };
              }
              return {
                success: true,
                data: data.data
              };
            });
          })
          .catch(function(error) {
            console.error('ChatAPI.sendMessage error:', error);
            return {
              success: false,
              error: 'Error de conexiÃ³n. Intenta de nuevo.'
            };
          });
        },

        /**
         * Reset session
         * @param {string} sessionId
         * @returns {Promise}
         */
        resetSession: function(sessionId) {
          return fetch(CONFIG.apiUrl + '/chat/reset', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({ session_id: sessionId })
          })
          .then(function(response) {
            return response.json().then(function(data) {
              if (!response.ok) {
                return {
                  success: false,
                  error: data.message || 'Error al resetear sesiÃ³n'
                };
              }
              return {
                success: true,
                data: data.data
              };
            });
          })
          .catch(function(error) {
            console.error('ChatAPI.resetSession error:', error);
            return {
              success: false,
              error: 'Error de conexiÃ³n'
            };
          });
        }
      };

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // WIDGET CONTROLLER
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      var Widget = {
        sessionId: null,
        currentLevel: 0,
        isOpen: false,
        phone: null,
        isLoading: false,
        conversationHistory: [],
        unreadCount: 0,
        elements: {},

        /**
         * Initialize the widget
         */
        init: function() {
          this.loadSession();
          this.createWidget();
          this.attachEventListeners();
          this.applyCustomColors();

          // Show welcome message if new session
          if (this.conversationHistory.length === 0) {
            this.showWelcomeMessage();
          } else {
            this.renderConversationHistory();
          }
        },

        /**
         * Generate UUID v4
         * @returns {string}
         */
        generateUUID: function() {
          return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random() * 16 | 0;
            var v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
          });
        },

        /**
         * Load session from localStorage
         */
        loadSession: function() {
          try {
            var lastActivity = localStorage.getItem(STORAGE_KEYS.LAST_ACTIVITY);
            
            // Check if session has expired (24h)
            if (lastActivity) {
              var timeSinceActivity = Date.now() - parseInt(lastActivity, 10);
              if (timeSinceActivity > SESSION_TIMEOUT) {
                this.clearSession();
                return;
              }
            }

            this.sessionId = localStorage.getItem(STORAGE_KEYS.SESSION_ID) || this.generateUUID();
            this.currentLevel = parseInt(localStorage.getItem(STORAGE_KEYS.CURRENT_LEVEL) || '0', 10);
            this.phone = localStorage.getItem(STORAGE_KEYS.PHONE) || null;

            var historyJson = localStorage.getItem(STORAGE_KEYS.CONVERSATION_HISTORY);
            if (historyJson) {
              this.conversationHistory = JSON.parse(historyJson);
            }

            localStorage.setItem(STORAGE_KEYS.SESSION_ID, this.sessionId);
            this.updateLastActivity();
          } catch (error) {
            console.error('Error loading session:', error);
            this.clearSession();
          }
        },

        /**
         * Save session to localStorage
         */
        saveSession: function() {
          try {
            localStorage.setItem(STORAGE_KEYS.SESSION_ID, this.sessionId);
            localStorage.setItem(STORAGE_KEYS.CURRENT_LEVEL, String(this.currentLevel));
            localStorage.setItem(STORAGE_KEYS.CONVERSATION_HISTORY, JSON.stringify(this.conversationHistory));
            
            if (this.phone) {
              localStorage.setItem(STORAGE_KEYS.PHONE, this.phone);
            }
            
            this.updateLastActivity();
          } catch (error) {
            console.error('Error saving session:', error);
          }
        },

        /**
         * Update last activity timestamp
         */
        updateLastActivity: function() {
          localStorage.setItem(STORAGE_KEYS.LAST_ACTIVITY, String(Date.now()));
        },

        /**
         * Clear session from localStorage
         */
        clearSession: function() {
          var keys = Object.keys(STORAGE_KEYS);
          for (var i = 0; i < keys.length; i++) {
            localStorage.removeItem(STORAGE_KEYS[keys[i]]);
          }
          
          this.sessionId = this.generateUUID();
          this.currentLevel = 0;
          this.phone = null;
          this.conversationHistory = [];
          
          localStorage.setItem(STORAGE_KEYS.SESSION_ID, this.sessionId);
        },

        /**
         * Create widget HTML and inject into DOM
         */
        createWidget: function() {
          var container = document.createElement('div');
          container.className = 'restaurant-chat-widget';
          container.setAttribute('role', 'region');
          container.setAttribute('aria-label', 'Chat de pedidos');

          var positionClass = CONFIG.position === 'bottom-left' ? 'bottom-left' : '';

          container.innerHTML = 
            '<!-- Floating Button -->' +
            '<button class="restaurant-chat-button ' + positionClass + '" ' +
                    'aria-label="Abrir chat" ' +
                    'aria-expanded="false" ' +
                    'aria-controls="restaurant-chat-window">' +
              '<span class="restaurant-chat-button-badge" aria-live="polite"></span>' +
              '<svg viewBox="0 0 24 24" aria-hidden="true">' +
                '<path d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H6l-2 2V4h16v12z"/>' +
              '</svg>' +
            '</button>' +

            '<!-- Chat Window -->' +
            '<div id="restaurant-chat-window" ' +
                 'class="restaurant-chat-window ' + positionClass + '" ' +
                 'role="dialog" ' +
                 'aria-labelledby="restaurant-chat-title" ' +
                 'aria-modal="true">' +
              
              '<!-- Header -->' +
              '<div class="restaurant-chat-header">' +
                '<div class="restaurant-chat-header-info">' +
                  '<div class="restaurant-chat-header-avatar">' +
                    '<!-- Embedded SVG Logo -->' +
                    '<svg viewBox="0 0 24 24" aria-hidden="true">' +
                      '<path d="M11 9H9V2H7v7H5V2H3v7c0 2.12 1.66 3.84 3.75 3.97V22h2.5v-9.03C11.34 12.84 13 11.12 13 9V2h-2v7zm5-3v8h2.5v8H21V2c-2.76 0-5 2.24-5 4z"/>' +
                    '</svg>' +
                  '</div>' +
                  '<div class="restaurant-chat-header-text">' +
                    '<h3 id="restaurant-chat-title">' + this.escapeHtml(CONFIG.restaurantName) + '</h3>' +
                    '<div class="restaurant-chat-header-status">' +
                      '<span class="restaurant-chat-header-status-dot"></span>' +
                      '<span>En lÃ­nea</span>' +
                    '</div>' +
                  '</div>' +
                '</div>' +
                '<button class="restaurant-chat-close-btn" aria-label="Cerrar chat">' +
                  '<svg viewBox="0 0 24 24" aria-hidden="true">' +
                    '<path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>' +
                  '</svg>' +
                '</button>' +
              '</div>' +

              '<!-- Messages Area -->' +
              '<div class="restaurant-chat-messages" ' +
                   'role="log" ' +
                   'aria-live="polite" ' +
                   'aria-label="Mensajes del chat">' +
                '<!-- Typing indicator -->' +
                '<div class="restaurant-chat-typing" aria-label="Escribiendo...">' +
                  '<div class="restaurant-chat-typing-dots">' +
                    '<span class="restaurant-chat-typing-dot"></span>' +
                    '<span class="restaurant-chat-typing-dot"></span>' +
                    '<span class="restaurant-chat-typing-dot"></span>' +
                  '</div>' +
                '</div>' +
              '</div>' +

              '<!-- Error message -->' +
              '<div class="restaurant-chat-error" role="alert"></div>' +

              '<!-- Input Area -->' +
              '<div class="restaurant-chat-input-area">' +
                '<div class="restaurant-chat-input-wrapper">' +
                  '<textarea class="restaurant-chat-input" ' +
                            'rows="1" ' +
                            'placeholder="' + getPlaceholder(this.currentLevel) + '" ' +
                            'aria-label="Escribe tu mensaje"></textarea>' +
                '</div>' +
                '<button class="restaurant-chat-send-btn" aria-label="Enviar mensaje">' +
                  '<svg viewBox="0 0 24 24" aria-hidden="true">' +
                    '<path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"/>' +
                  '</svg>' +
                '</button>' +
              '</div>' +
            '</div>';

          document.body.appendChild(container);

          // Store element references
          this.elements = {
            container: container,
            button: container.querySelector('.restaurant-chat-button'),
            badge: container.querySelector('.restaurant-chat-button-badge'),
            window: container.querySelector('.restaurant-chat-window'),
            closeBtn: container.querySelector('.restaurant-chat-close-btn'),
            messages: container.querySelector('.restaurant-chat-messages'),
            typing: container.querySelector('.restaurant-chat-typing'),
            error: container.querySelector('.restaurant-chat-error'),
            input: container.querySelector('.restaurant-chat-input'),
            sendBtn: container.querySelector('.restaurant-chat-send-btn'),
            statusDot: container.querySelector('.restaurant-chat-header-status-dot')
          };
        },

        /**
         * Apply custom colors
         */
        applyCustomColors: function() {
          if (CONFIG.primaryColor) {
            var root = document.documentElement;
            root.style.setProperty('--widget-primary', CONFIG.primaryColor);
            
            // Calculate darker shade for hover
            var darkerColor = this.adjustColor(CONFIG.primaryColor, -20);
            root.style.setProperty('--widget-primary-dark', darkerColor);
          }
        },

        /**
         * Adjust color brightness
         * @param {string} color
         * @param {number} amount
         * @returns {string}
         */
        adjustColor: function(color, amount) {
          var hex = color.replace('#', '');
          var num = parseInt(hex, 16);
          
          var r = (num >> 16) + amount;
          var g = ((num >> 8) & 0x00FF) + amount;
          var b = (num & 0x0000FF) + amount;
          
          r = Math.max(0, Math.min(255, r));
          g = Math.max(0, Math.min(255, g));
          b = Math.max(0, Math.min(255, b));
          
          return '#' + ((1 << 24) + (r << 16) + (g << 8) + b).toString(16).slice(1);
        },

        /**
         * Attach event listeners
         */
        attachEventListeners: function() {
          var self = this;

          // Toggle button
          this.elements.button.addEventListener('click', function() {
            self.toggle();
          });

          // Close button
          this.elements.closeBtn.addEventListener('click', function() {
            self.close();
          });

          // Send button
          this.elements.sendBtn.addEventListener('click', function() {
            self.sendMessage();
          });

          // Input enter key
          this.elements.input.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && !e.shiftKey) {
              e.preventDefault();
              self.sendMessage();
            }
          });

          // Auto-resize textarea
          this.elements.input.addEventListener('input', function() {
            self.autoResizeInput();
          });

          // Escape key to close
          document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && self.isOpen) {
              self.close();
            }
          });
        },

        /**
         * Auto-resize textarea based on content
         */
        autoResizeInput: function() {
          var input = this.elements.input;
          input.style.height = 'auto';
          input.style.height = Math.min(input.scrollHeight, 120) + 'px';
        },

        /**
         * Toggle chat window
         */
        toggle: function() {
          if (this.isOpen) {
            this.close();
          } else {
            this.open();
          }
        },

        /**
         * Open chat window
         */
        open: function() {
          this.isOpen = true;
          this.elements.window.classList.add('open');
          this.elements.button.classList.add('open');
          this.elements.button.setAttribute('aria-expanded', 'true');
          this.elements.input.focus();
          this.scrollToBottom();
          this.clearUnreadCount();
        },

        /**
         * Close chat window
         */
        close: function() {
          this.isOpen = false;
          this.elements.window.classList.remove('open');
          this.elements.button.classList.remove('open');
          this.elements.button.setAttribute('aria-expanded', 'false');
        },

        /**
         * Show welcome message
         */
        showWelcomeMessage: function() {
          var self = this;
          
          this.showTypingIndicator();
          
          // Send initial message to get welcome from backend
          ChatAPI.sendMessage(this.sessionId, 'hola', this.phone)
            .then(function(response) {
              self.hideTypingIndicator();

              if (response.success && response.data) {
                self.currentLevel = response.data.current_level || 0;
                self.addMessageToUI('bot', response.data.message);
                self.saveSession();
              } else {
                // Fallback welcome message
                var welcomeMsg = 'ğŸ‘‹ Â¡Bienvenido! Estoy aquÃ­ para ayudarte con tu pedido. Â¿En quÃ© puedo ayudarte?';
                self.addMessageToUI('bot', welcomeMsg);
              }

              self.updatePlaceholder();
            });
        },

        /**
         * Send user message
         */
        sendMessage: function() {
          var self = this;
          var message = this.elements.input.value.trim();
          
          if (!message || this.isLoading) {
            return;
          }

          // Check if readonly
          if (isReadonly(this.currentLevel)) {
            return;
          }

          // Client-side validation
          var validation = validateInput(this.currentLevel, message);
          if (!validation.valid) {
            this.showError(validation.errorMsg);
            return;
          }

          this.hideError();

          // Add user message to UI
          this.addMessageToUI('user', message);
          
          // Clear input
          this.elements.input.value = '';
          this.autoResizeInput();

          // Show loading state
          this.setLoading(true);
          this.showTypingIndicator();

          // Check if this is phone input (level 1)
          if (this.currentLevel === 1 && /^\d{10}$/.test(message)) {
            this.phone = message;
          }

          // Send to backend
          ChatAPI.sendMessage(this.sessionId, message, this.phone)
            .then(function(response) {
              self.hideTypingIndicator();
              self.setLoading(false);

              if (response.success && response.data) {
                self.currentLevel = response.data.current_level || self.currentLevel;
                self.addMessageToUI('bot', response.data.message);
                self.saveSession();
                self.updatePlaceholder();

                // Check if order completed (level 13)
                if (self.currentLevel === 13) {
                  setTimeout(function() {
                    self.clearSession();
                  }, ORDER_COMPLETION_CLEANUP_TIMEOUT);
                }
              } else {
                self.showError(response.error || 'Error al procesar tu mensaje');
              }
            });
        },

        /**
         * Add message to UI
         * @param {string} role - 'bot' or 'user'
         * @param {string} message
         */
        addMessageToUI: function(role, message) {
          var timestamp = new Date().toISOString();
          
          // Add to history
          this.conversationHistory.push({ role: role, message: message, timestamp: timestamp });
          
          // Create message element
          var messageEl = this.createMessageElement(role, message, timestamp);
          
          // Insert before typing indicator
          this.elements.messages.insertBefore(messageEl, this.elements.typing);
          
          this.scrollToBottom();

          // Update unread count if window is closed
          if (!this.isOpen && role === 'bot') {
            this.incrementUnreadCount();
          }
        },

        /**
         * Create message element
         * @param {string} role
         * @param {string} message
         * @param {string} timestamp
         * @returns {HTMLElement}
         */
        createMessageElement: function(role, message, timestamp) {
          var div = document.createElement('div');
          div.className = 'restaurant-chat-message ' + role;
          
          var time = new Date(timestamp);
          var hours = time.getHours().toString().padStart(2, '0');
          var minutes = time.getMinutes().toString().padStart(2, '0');
          var timeStr = hours + ':' + minutes;

          div.innerHTML = 
            '<div class="restaurant-chat-message-bubble">' + this.formatMessage(message) + '</div>' +
            '<div class="restaurant-chat-message-timestamp">' + timeStr + '</div>';

          return div;
        },

        /**
         * Format message (handle emojis, line breaks, etc.)
         * @param {string} message
         * @returns {string}
         */
        formatMessage: function(message) {
          // Escape HTML first
          var formatted = this.escapeHtml(message);
          
          // Convert newlines to <br>
          formatted = formatted.replace(/\n/g, '<br>');
          
          return formatted;
        },

        /**
         * Escape HTML special characters
         * @param {string} text
         * @returns {string}
         */
        escapeHtml: function(text) {
          var div = document.createElement('div');
          div.textContent = text;
          return div.innerHTML;
        },

        /**
         * Render conversation history
         */
        renderConversationHistory: function() {
          var self = this;
          this.conversationHistory.forEach(function(item) {
            var messageEl = self.createMessageElement(item.role, item.message, item.timestamp);
            self.elements.messages.insertBefore(messageEl, self.elements.typing);
          });
          
          this.scrollToBottom();
          this.updatePlaceholder();
        },

        /**
         * Scroll messages to bottom (auto-scroll)
         */
        scrollToBottom: function() {
          var self = this;
          requestAnimationFrame(function() {
            self.elements.messages.scrollTop = self.elements.messages.scrollHeight;
          });
        },

        /**
         * Show typing indicator
         */
        showTypingIndicator: function() {
          this.elements.typing.classList.add('visible');
          this.scrollToBottom();
        },

        /**
         * Hide typing indicator
         */
        hideTypingIndicator: function() {
          this.elements.typing.classList.remove('visible');
        },

        /**
         * Set loading state
         * @param {boolean} loading
         */
        setLoading: function(loading) {
          this.isLoading = loading;
          this.elements.input.disabled = loading;
          this.elements.sendBtn.disabled = loading;
        },

        /**
         * Update input placeholder based on current level
         */
        updatePlaceholder: function() {
          this.elements.input.placeholder = getPlaceholder(this.currentLevel);
          
          if (isReadonly(this.currentLevel)) {
            this.elements.input.disabled = true;
            this.elements.sendBtn.disabled = true;
          } else {
            this.elements.input.disabled = this.isLoading;
            this.elements.sendBtn.disabled = this.isLoading;
          }
        },

        /**
         * Show error message
         * @param {string} message
         */
        showError: function(message) {
          var self = this;
          this.elements.error.textContent = message;
          this.elements.error.classList.add('visible');
          
          // Auto-hide after 5 seconds
          setTimeout(function() {
            self.hideError();
          }, 5000);
        },

        /**
         * Hide error message
         */
        hideError: function() {
          this.elements.error.classList.remove('visible');
        },

        /**
         * Increment unread message count
         */
        incrementUnreadCount: function() {
          this.unreadCount++;
          this.updateBadge();
        },

        /**
         * Clear unread message count
         */
        clearUnreadCount: function() {
          this.unreadCount = 0;
          this.updateBadge();
        },

        /**
         * Update badge visibility and count
         */
        updateBadge: function() {
          if (this.unreadCount > 0) {
            this.elements.badge.textContent = this.unreadCount > 9 ? '9+' : String(this.unreadCount);
            this.elements.badge.classList.add('visible');
          } else {
            this.elements.badge.classList.remove('visible');
          }
        },

        /**
         * Set connection status
         * @param {boolean} online
         */
        setConnectionStatus: function(online) {
          if (online) {
            this.elements.statusDot.classList.remove('offline');
          } else {
            this.elements.statusDot.classList.add('offline');
          }
        },

        /**
         * Reset session and start fresh
         */
        resetSession: function() {
          var self = this;
          ChatAPI.resetSession(this.sessionId)
            .then(function() {
              self.clearSession();
              
              // Clear UI
              var messages = self.elements.messages.querySelectorAll('.restaurant-chat-message');
              messages.forEach(function(msg) { msg.remove(); });
              
              self.showWelcomeMessage();
            });
        },

        /**
         * Destroy widget and clean up
         */
        destroy: function() {
          if (this.elements.container) {
            this.elements.container.remove();
          }
        }
      };

      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
      // INITIALIZE WIDGET ON DOM READY
      // â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          Widget.init();
        });
      } else {
        Widget.init();
      }

      // Expose to global scope for external configuration
      window.RestauranteChatWidget = {
        config: CONFIG,
        reset: function() { Widget.resetSession(); },
        open: function() { Widget.open(); },
        close: function() { Widget.close(); },
        destroy: function() { Widget.destroy(); }
      };

    })();
  </script>
</body>
</html>
