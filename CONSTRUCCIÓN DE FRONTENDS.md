ğŸ—ï¸ ARQUITECTURA REAL DEL SISTEMA
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CAPA FRONTEND (5 APPS)                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“± app.restaurante.com      (PWA Cliente)                  â”‚
â”‚  ğŸ“± mesero.restaurante.com   (PWA Mesero)                   â”‚
â”‚  ğŸ“± cocina.restaurante.com   (PWA Cocina)                   â”‚
â”‚  ğŸ“± panel.restaurante.com    (PWA Admin)                    â”‚
â”‚  ğŸŒ widget.restaurante.com   (Widget HTML)                  â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ TODAS consumen la MISMA API
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           ğŸ”— api.restaurante.com (Puerto 4000)              â”‚
â”‚                  BACKEND NODE.JS ÃšNICO                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  ğŸ“¡ REST API Endpoints                                      â”‚
â”‚  ğŸ”Œ WebSocket Server                                        â”‚
â”‚  ğŸ¤– State Machine (Chat)                                    â”‚
â”‚  ğŸ” AutenticaciÃ³n JWT                                       â”‚
â”‚  ğŸ“§ Notificaciones                                          â”‚
â”‚  â° Cron Jobs                                               â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         ğŸ’¾ DIRECTUS + POSTGRESQL (Puerto 8055)              â”‚
â”‚                   BASE DE DATOS ÃšNICA                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  â€¢ customers           â€¢ menu_items                         â”‚
â”‚  â€¢ orders              â€¢ order_items                        â”‚
â”‚  â€¢ reservations        â€¢ tables                             â”‚
â”‚  â€¢ waiters             â€¢ kitchen_queue                      â”‚
â”‚  â€¢ sessions            â€¢ etc...                             â”‚
â”‚                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
âš ï¸ REQUISITO CRÃTICO: APPS DESCARGABLES/INSTALABLES
Todas las PWA (Cliente, Mesero, Cocina, Admin) DEBEN ser instalables en dispositivos mÃ³viles y escritorio como aplicaciones nativas.

ğŸ”§ CONFIGURACIONES NECESARIAS EN CADA PWA
1ï¸âƒ£ MANIFEST.JSON (OBLIGATORIO)
UbicaciÃ³n: public/manifest.json
PWA CLIENTE:
json{
  "name": "Restaurante - Pedidos",
  "short_name": "Restaurante",
  "description": "Pide comida a domicilio o reserva tu mesa",
  "start_url": "/",
  "scope": "/",
  "display": "standalone",
  "orientation": "portrait",
  "theme_color": "#FF6B35",
  "background_color": "#FFFFFF",
  "icons": [
    {
      "src": "/icons/icon-72x72.png",
      "sizes": "72x72",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-96x96.png",
      "sizes": "96x96",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-128x128.png",
      "sizes": "128x128",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-144x144.png",
      "sizes": "144x144",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-152x152.png",
      "sizes": "152x152",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-192x192.png",
      "sizes": "192x192",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-384x384.png",
      "sizes": "384x384",
      "type": "image/png",
      "purpose": "any maskable"
    },
    {
      "src": "/icons/icon-512x512.png",
      "sizes": "512x512",
      "type": "image/png",
      "purpose": "any maskable"
    }
  ],
  "categories": ["food", "lifestyle"],
  "screenshots": [
    {
      "src": "/screenshots/home.png",
      "sizes": "540x720",
      "type": "image/png"
    },
    {
      "src": "/screenshots/menu.png",
      "sizes": "540x720",
      "type": "image/png"
    }
  ]
}
PWA MESERO:
Igual pero cambiar:

name: "Restaurante - Meseros"
short_name: "Mesero"
description: "App para meseros"
categories: ["business", "productivity"]

PWA COCINA:
Igual pero cambiar:

name: "Restaurante - Cocina"
short_name: "Cocina"
description: "Comandas de cocina"
orientation: "landscape" (pantalla horizontal)
categories: ["business", "productivity"]

PWA ADMIN:
Igual pero cambiar:

name: "Restaurante - Admin"
short_name: "Admin"
description: "Panel de administraciÃ³n"
orientation: "any"
categories: ["business", "productivity"]


2ï¸âƒ£ SERVICE WORKER (OBLIGATORIO)
UbicaciÃ³n: public/service-worker.js
DEBE IMPLEMENTAR:
InstalaciÃ³n (install event):

Cachear assets crÃ­ticos inmediatamente:

HTML principal
CSS compilado
JavaScript bundles
Iconos del manifest
Fuentes
ImÃ¡genes del logo



ActivaciÃ³n (activate event):

Limpiar cachÃ©s antiguos
Tomar control de todos los clientes

Fetch event - Estrategias de cache:

ImÃ¡genes de productos: Cache First, fallback Network
API calls: Network First, fallback Cache (solo GET)
Assets estÃ¡ticos: Cache First
HTML pages: Network First

Offline fallback:

PÃ¡gina offline.html personalizada cuando no hay red

Push notifications:

Listener para notificaciones push del backend
Mostrar notificaciÃ³n con tÃ­tulo, body, Ã­cono, badge
Click notification: abrir app en URL especÃ­fica


3ï¸âƒ£ REGISTRO DEL SERVICE WORKER
En React: src/index.tsx o src/App.tsx
DEBE INCLUIR:
FunciÃ³n de registro:

Detectar si navegador soporta Service Workers
Registrar /service-worker.js en window.load
Manejar eventos: installing, waiting, active
Mostrar toast cuando hay actualizaciÃ³n disponible
BotÃ³n para recargar y activar nueva versiÃ³n

LÃ³gica de actualizaciÃ³n:

Detectar cuando hay nuevo SW esperando
Mostrar banner: "Nueva versiÃ³n disponible. Â¿Actualizar?"
Al confirmar: skipWaiting() + reload pÃ¡gina


4ï¸âƒ£ BOTÃ“N DE INSTALACIÃ“N (UI)
Componente: src/components/InstallPrompt.tsx
DEBE MOSTRAR:

Banner/modal cuando la app es instalable
Texto: "Instala [Nombre App] en tu dispositivo"
BotÃ³n: "ğŸ“¥ Instalar App"
BotÃ³n cerrar: "Ahora no"

LÃ“GICA REQUERIDA:

Escuchar evento beforeinstallprompt
Guardar el evento en estado
Mostrar banner solo si el evento existe
Click "Instalar": ejecutar prompt() del evento guardado
Escuchar resultado: installed/dismissed
Ocultar banner despuÃ©s de instalar
Guardar en localStorage si usuario rechazÃ³ (no mostrar de nuevo)

UbicaciÃ³n del banner:

PWA Cliente: parte superior de Home
PWA Mesero: despuÃ©s del login
PWA Cocina: parte superior
PWA Admin: dashboard


5ï¸âƒ£ META TAGS EN HTML (OBLIGATORIO)
UbicaciÃ³n: public/index.html
DEBE CONTENER:
html<head>
  <!-- PWA Meta Tags -->
  <meta name="application-name" content="Restaurante">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Restaurante">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#FF6B35">
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icons/icon-152x152.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icons/icon-144x144.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icons/icon-120x120.png">
  
  <!-- Manifest -->
  <link rel="manifest" href="/manifest.json">
  
  <!-- Favicons -->
  <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
  
  <!-- Splash Screens iOS (opcional pero recomendado) -->
  <link rel="apple-touch-startup-image" href="/splash/iphone5_splash.png" media="(device-width: 320px) and (device-height: 568px)">
  <link rel="apple-touch-startup-image" href="/splash/iphone6_splash.png" media="(device-width: 375px) and (device-height: 667px)">
  <link rel="apple-touch-startup-image" href="/splash/iphoneplus_splash.png" media="(device-width: 414px) and (device-height: 736px)">
  <link rel="apple-touch-startup-image" href="/splash/iphonex_splash.png" media="(device-width: 375px) and (device-height: 812px)">
  <link rel="apple-touch-startup-image" href="/splash/iphonexr_splash.png" media="(device-width: 414px) and (device-height: 896px)">
  <link rel="apple-touch-startup-image" href="/splash/iphonexsmax_splash.png" media="(device-width: 414px) and (device-height: 896px)">
  <link rel="apple-touch-startup-image" href="/splash/ipad_splash.png" media="(device-width: 768px) and (device-height: 1024px)">
  <link rel="apple-touch-startup-image" href="/splash/ipadpro1_splash.png" media="(device-width: 834px) and (device-height: 1112px)">
  <link rel="apple-touch-startup-image" href="/splash/ipadpro2_splash.png" media="(device-width: 1024px) and (device-height: 1366px)">
</head>

6ï¸âƒ£ GENERACIÃ“N DE ICONOS
HERRAMIENTA RECOMENDADA: PWA Asset Generator o Favicon Generator
ICONOS NECESARIOS:

Partir de imagen cuadrada 512x512px (PNG con fondo)
Generar todos los tamaÃ±os:

72x72, 96x96, 128x128, 144x144, 152x152, 192x192, 384x384, 512x512


Formato: PNG con transparencia (o fondo sÃ³lido)
Purpose "maskable": versiones con padding 10% para Android adaptativo

UbicaciÃ³n: public/icons/
Apple Touch Icons:

180x180px
PNG sin transparencia (fondo sÃ³lido)
Bordes redondeados aplicados por iOS automÃ¡ticamente

UbicaciÃ³n: public/icons/

7ï¸âƒ£ SPLASH SCREENS (iOS)
GENERACIÃ“N:

Usar herramienta: https://appsco.pe/developer/splash-screens
Subir icono 512x512px
Descargar pack completo de splash screens
Ubicar en: public/splash/

TAMAÃ‘OS NECESARIOS:

iPhone 5/SE: 640x1136px
iPhone 6/7/8: 750x1334px
iPhone Plus: 1242x2208px
iPhone X/XS: 1125x2436px
iPhone XR/11: 828x1792px
iPhone XS Max/11 Pro Max: 1242x2688px
iPad: 1536x2048px
iPad Pro 10.5": 1668x2224px
iPad Pro 12.9": 2048x2732px


8ï¸âƒ£ HTTPS (OBLIGATORIO)
REQUISITO:

Service Workers solo funcionan en HTTPS (excepto localhost)
Certificado SSL ya configurado con Certbot (Fase 7 del deploy)
Validar que todas las PWA estÃ©n servidas en HTTPS


9ï¸âƒ£ VALIDACIONES Y TESTING
HERRAMIENTAS:

Lighthouse (Chrome DevTools):

Auditar PWA
Verificar que pase los criterios de instalabilidad
Score PWA debe ser 90+



CRITERIOS DE INSTALABILIDAD:

âœ… Servido en HTTPS
âœ… Manifest.json vÃ¡lido y accesible
âœ… Iconos 192x192 y 512x512 presentes
âœ… Service Worker registrado
âœ… start_url carga correctamente
âœ… No muestra "Add to Home Screen" banner por defecto

TESTING MANUAL:
Android (Chrome):

Abrir app en Chrome mÃ³vil
MenÃº â†’ "Agregar a pantalla de inicio"
Verificar que muestra nombre e Ã­cono correcto
Instalar y abrir desde launcher
Verificar que abre en standalone (sin barra de navegador)

iOS (Safari):

Abrir app en Safari mÃ³vil
BotÃ³n compartir â†’ "Agregar a pantalla de inicio"
Verificar nombre e Ã­cono
Abrir desde home screen
Verificar splash screen y modo standalone

Desktop (Chrome/Edge):

Icono de instalaciÃ³n en barra de direcciones
Click â†’ "Instalar"
Verificar que abre en ventana independiente


ğŸ”Ÿ COMPORTAMIENTO POST-INSTALACIÃ“N
TODAS LAS PWA DEBEN:
Detectar si estÃ¡n instaladas:

Usar window.matchMedia('(display-mode: standalone)').matches
Si instalada: ocultar banner de instalaciÃ³n
Opcional: mostrar mensaje de bienvenida "Gracias por instalar"

ActualizaciÃ³n automÃ¡tica:

Service Worker detecta nueva versiÃ³n
Mostrar snackbar: "Nueva versiÃ³n disponible"
BotÃ³n "Actualizar ahora"
Al actualizar: skipWaiting() + location.reload()

Badges (Android):

Actualizar badge con nÃºmero de notificaciones pendientes
Usar: navigator.setAppBadge(count)

Shortcuts (accesos directos en menÃº):

Agregar en manifest.json secciÃ³n "shortcuts":

json  "shortcuts": [
    {
      "name": "Ver MenÃº",
      "short_name": "MenÃº",
      "description": "Ver menÃº del restaurante",
      "url": "/menu",
      "icons": [{ "src": "/icons/menu-shortcut.png", "sizes": "192x192" }]
    },
    {
      "name": "Mis Pedidos",
      "short_name": "Pedidos",
      "url": "/orders",
      "icons": [{ "src": "/icons/orders-shortcut.png", "sizes": "192x192" }]
    }
  ]
Share API (compartir app):

BotÃ³n "Compartir app" en menÃº
Usar: navigator.share({title, text, url})


âš™ï¸ CONFIGURACIÃ“N NGINX PARA PWA
CADA DOMINIO DEBE TENER:
nginx# Cache para Service Worker (mÃ¡ximo 5 minutos para permitir actualizaciones)
location /service-worker.js {
    add_header Cache-Control "public, max-age=300, must-revalidate";
    add_header Service-Worker-Allowed "/";
}

# Cache para manifest
location /manifest.json {
    add_header Cache-Control "public, max-age=3600";
}

# Cache largo para assets estÃ¡ticos
location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
    add_header Cache-Control "public, max-age=31536000, immutable";
}

# Headers de seguridad
add_header X-Frame-Options "SAMEORIGIN" always;
add_header X-Content-Type-Options "nosniff" always;
add_header X-XSS-Protection "1; mode=block" always;

ğŸ“‹ CHECKLIST FINAL DE INSTALABILIDAD
POR CADA PWA VERIFICAR:
Archivos:

âœ… manifest.json en public/ con todos los campos
âœ… Iconos 72-512px en public/icons/
âœ… Apple touch icons en public/icons/
âœ… Splash screens en public/splash/ (iOS)
âœ… service-worker.js en public/
âœ… offline.html en public/

CÃ³digo:

âœ… Service Worker registrado en src/index.tsx
âœ… Componente InstallPrompt implementado
âœ… Meta tags de PWA en index.html
âœ… Link a manifest en index.html
âœ… Theme color configurado
âœ… Manejo de evento beforeinstallprompt
âœ… DetecciÃ³n de modo standalone
âœ… LÃ³gica de actualizaciÃ³n del SW

Testing:

âœ… Lighthouse PWA score 90+
âœ… Instalable en Android Chrome
âœ… Instalable en iOS Safari
âœ… Instalable en Desktop Chrome/Edge
âœ… Funciona offline (pÃ¡ginas bÃ¡sicas)
âœ… Notificaciones push funcionan
âœ… Splash screen se muestra (iOS)
âœ… Ãcono correcto en launcher
âœ… Abre en standalone (sin barra navegador)
âœ… ActualizaciÃ³n automÃ¡tica funciona

Nginx:

âœ… HTTPS activo
âœ… Headers correctos para SW
âœ… Cache configurado apropiadamente


ğŸ¯ PRIORIDAD DE IMPLEMENTACIÃ“N

ConfiguraciÃ³n bÃ¡sica: manifest + SW + meta tags (todas las PWA)
Iconos y assets: generar todos los tamaÃ±os necesarios
BotÃ³n de instalaciÃ³n: componente InstallPrompt
Testing: validar instalaciÃ³n en cada plataforma
OptimizaciÃ³n: splash screens, shortcuts, badges


ğŸš¨ ERRORES COMUNES A EVITAR
âŒ Service Worker no cachea start_url:

Resultado: app no funciona offline despuÃ©s de instalar

âŒ Manifest sin iconos maskable:

Resultado: Ã­cono mal recortado en Android adaptativo

âŒ Theme color no coincide con UI:

Resultado: barra de estado con color inconsistente

âŒ Service Worker con cache-control largo:

Resultado: actualizaciones no se descargan

âŒ Olvidar meta tag viewport:

Resultado: app no responsive en mÃ³vil

âŒ Links externos sin target="_blank":

Resultado: abandona la PWA instalada

âŒ No detectar display-mode standalone:

Resultado: muestra banner de instalaciÃ³n dentro de app instalada


ğŸ’¡ MEJORAS OPCIONALES
Avanzadas:

Background Sync: encolar pedidos offline, enviar cuando vuelve conexiÃ³n
Periodic Background Sync: actualizar datos en background
Web Share Target: recibir compartidos de otras apps
Payment Request API: integrar pagos nativos
Geolocation: autocompletar direcciÃ³n del cliente
QR Code Scanner: escanear cÃ³digo de mesa (PWA Mesero)

Analytics:

Trackear instalaciones
Trackear uso standalone vs browser
Trackear engagement post-instalaciÃ³n


FIN DE INSTRUCCIONES DE INSTALABILIDAD



ğŸ“‹ Resumen ejecutivo:
ComponenteNivel de detalleÂ¿GenerarÃ¡ cÃ³digo funcional?Backend Node.jsâ­â­â­â­â­ (100%)âœ… SÃDirectusâ­â­â­â­â­ (100%)âœ… SÃBase de datosâ­â­â­â­â­ (100%)âœ… SÃWidget Chatâ­â­ (40%)âš ï¸ Estructura solamentePWA Clienteâ­â­ (30%)âš ï¸ Estructura solamentePWA Meseroâ­â­ (30%)âš ï¸ Estructura solamentePWA Cocinaâ­â­ (30%)âš ï¸ Estructura solamentePWA Adminâ­â­ (30%)âš ï¸ Estructura solamente
ğŸ“± INSTRUCCIONES COMPLETAS PARA CONSTRUCCIÃ“N DE FRONTENDS
âš ï¸ CONTEXTO CRÃTICO

Backend ya estÃ¡ funcionando en http://localhost:4000
API REST disponible con todos los endpoints
WebSocket server en /kitchen, /waiter, /admin
Directus en http://localhost:8055 para subir imÃ¡genes


1ï¸âƒ£ WIDGET CHAT HTML
ğŸ“ UbicaciÃ³n: /opt/restaurante-erp/widget-chat/
Archivos a crear:
index.html
DEBE CONTENER:

BotÃ³n flotante fijo en esquina inferior derecha
Ventana de chat desplegable (oculta por defecto)
Header con logo y botÃ³n cerrar
Ãrea de mensajes con scroll automÃ¡tico
Input de texto deshabilitado (solo nÃºmeros y texto segÃºn nivel)
Indicador de "escribiendo..." cuando espera respuesta
Badge con contador si hay mensajes nuevos
Responsive: 380px ancho en desktop, fullscreen en mÃ³vil
Z-index alto (9999) para estar sobre todo contenido

chat.js
DEBE IMPLEMENTAR:
INICIALIZACIÃ“N:

Generar o recuperar session_id desde localStorage
Si no existe: crear UUID, guardar en localStorage
Cargar estado de sesiÃ³n desde API: GET /api/chat/session/:sessionId
Si existe sesiÃ³n activa: cargar current_level y mostrar Ãºltimo mensaje
Si no existe: iniciar en nivel 0

STATE MACHINE LOCAL:

Variable currentLevel (0-15)
Variable conversationHistory (array de mensajes)
Variable sessionData (carrito, categorÃ­a seleccionada, etc)

MANEJO DE MENSAJES:

Al enviar mensaje usuario:

Validar input segÃºn nivel actual (solo nÃºmeros si es menÃº)
Mostrar mensaje del usuario en chat
Deshabilitar input
Mostrar "escribiendo..."
POST a /api/chat/process con: {sessionId, message, currentLevel}
Recibir respuesta: {response, newLevel, sessionData, options?}
Mostrar respuesta del bot con formato
Actualizar currentLevel = newLevel
Si hay options: mostrar como botones numerados
Habilitar input
Scroll automÃ¡tico al final



VALIDACIONES LOCALES:

Nivel 1 (telÃ©fono): solo 10 dÃ­gitos numÃ©ricos
Niveles de menÃº (2-5): solo nÃºmeros de las opciones mostradas
Nivel 11 (pago): solo nÃºmeros 1-4
Si input invÃ¡lido: no enviar, mostrar mensaje de error temporal

FORMATO DE MENSAJES BOT:

Detectar emojis y renderizarlos
Detectar listas numeradas y agregar indentaciÃ³n
Detectar separadores (â”€â”€â”€) y renderizar como lÃ­nea visual
Detectar montos ($X.XXX) y resaltarlos en negrita
Detectar cÃ³digos (PED-XXX, RES-XXX) y resaltarlos

MANEJO DE HORARIO:

Al iniciar (nivel 0): mostrar mensaje si cerrado
Si cerrado: deshabilitar input, solo mostrar horarios
Actualizar cada 60 segundos por si cambia horario

PERSISTENCIA:

Guardar conversationHistory en localStorage cada mensaje
MÃ¡ximo 50 mensajes en historia (FIFO)
Al reabrir: recuperar historia y mostrar Ãºltimos 10 mensajes

CARRITO VISUAL:

Cuando nivel 6+: mostrar badge con cantidad de items en botÃ³n flotante
Al agregar item: animaciÃ³n de "agregado al carrito"

styles.css
DEBE INCLUIR:

BotÃ³n flotante: cÃ­rculo 60px, color primario, sombra, animaciÃ³n pulse
Ventana chat: 380px ancho, 600px alto, border-radius 20px, sombra
Header: gradiente, 60px alto, sticky
Ãrea mensajes: padding 20px, background claro
Mensaje usuario: burbuja derecha, color primario, texto blanco
Mensaje bot: burbuja izquierda, background gris claro, texto oscuro
Input: border-radius completo, 50px alto, padding lateral
Botones de opciones: grid 2 columnas, border, hover effect
Animaciones: slide-up al abrir, fade-in mensajes
Loading dots: 3 puntos animados
Responsive: media query para mÃ³viles (fullscreen, safe-area)


2ï¸âƒ£ PWA CLIENTE (React + TypeScript)
ğŸ“ UbicaciÃ³n: /opt/restaurante-erp/pwa-cliente/
Estructura completa a implementar:
src/App.tsx
DEBE CONTENER:

Router con rutas protegidas
Layout wrapper con Header + Content + BottomNav
Context Providers: AuthContext, CartContext
React Query Client configurado
Socket.IO connection para notificaciones push
Service Worker registration
Toast notifications container

src/pages/Home.tsx
DEBE MOSTRAR:

Hero section con imagen del restaurante
Estado actual: "ğŸŸ¢ Abierto hasta las 22:00" (tiempo real)
2 botones grandes: "ğŸ• Pedir Ahora" | "ğŸª‘ Reservar Mesa"
Barra de bÃºsqueda de productos
Scroll horizontal de categorÃ­as (cards con imagen)
SecciÃ³n "ğŸ”¥ MÃ¡s Populares" (grid de productos)
Cada producto: imagen, nombre, precio, domicilio, rating, botÃ³n "+Agregar"
Footer con info del restaurante

LÃ“GICA REQUERIDA:

Fetch de horario actual cada 60 seg: GET /api/chat/schedule
Si cerrado: deshabilitar botÃ³n "Pedir Ahora", mostrar horarios
Fetch categorÃ­as activas: GET /api/menu/categories?status=active
Fetch productos populares (top 10): GET /api/menu/items?limit=10&sort=-views
BÃºsqueda en tiempo real (debounce 300ms): GET /api/menu/items?search={query}
Click categorÃ­a: navigate a /menu?category={id}

src/pages/Menu.tsx
DEBE MOSTRAR:

Filtros: CategorÃ­as (tabs horizontales)
Filtros: SubcategorÃ­as (dropdown)
Grid de productos (responsive: 1 col mÃ³vil, 2 cols tablet, 3 cols desktop)
Cada producto: imagen, nombre, descripciÃ³n corta, precio, domicilio, "+Agregar"
PaginaciÃ³n o scroll infinito
BotÃ³n "Ver Carrito" flotante (badge con cantidad)

LÃ“GICA REQUERIDA:

Query params: ?category=uuid&subcategory=uuid
Fetch productos filtrados: GET /api/menu/items?category={id}&subcategory={id}&status=active
Click producto: navigate a /product/{id}
Click "+Agregar": mostrar modal de cantidad/notas, agregar a CartContext
Validar horario antes de agregar: si cerrado, mostrar error

src/pages/Product.tsx
DEBE MOSTRAR:

Imagen grande (carousel si hay mÃºltiples)
Nombre del producto
Rating â­ y nÃºmero de reviews
DescripciÃ³n completa
Precio destacado
Costo de domicilio
Tiempo de preparaciÃ³n
EstaciÃ³n de cocina
Selector de cantidad (- / nÃºmero / +)
Textarea para instrucciones especiales
BotÃ³n grande "Agregar al carrito $XX.XXX"

LÃ“GICA REQUERIDA:

Fetch producto: GET /api/menu/items/{id}
Validar que status='active', sino mostrar "Producto no disponible"
RE-VALIDAR horario al hacer click en "Agregar"
RE-VALIDAR producto activo al hacer click en "Agregar"
Si pasa validaciones: agregar a CartContext con {id, name, quantity, unit_price, item_delivery_cost, special_instructions}
Mostrar toast "âœ… Agregado al carrito"
Navigate a /cart

src/pages/Cart.tsx
DEBE MOSTRAR:

Lista de items con: imagen mini, nombre, cantidad, precio unitario, subtotal
Cada item: botones "+/-" para cantidad, "ğŸ—‘ï¸" para eliminar
Campo "Instrucciones" editable por item
Resumen:

Subtotal: $XX.XXX
Domicilio: $X.XXX (MAX de los items, NO suma)
Total: $XX.XXX


BotÃ³n "Seguir comprando"
BotÃ³n grande "Finalizar pedido"

LÃ“GICA REQUERIDA:

Leer items de CartContext
Calcular subtotal: suma de (quantity * unit_price)
Calcular domicilio: Math.max(...items.map(i => i.item_delivery_cost))
Total: subtotal + delivery
Actualizar cantidad: modificar CartContext
Eliminar item: quitar de CartContext
Click "Finalizar": navigate a /checkout

src/pages/Checkout.tsx
DEBE MOSTRAR:

Steps indicator: 1âƒ£ DirecciÃ³n â†’ 2âƒ£ Pago â†’ 3âƒ£ Confirmar
Step 1 - DirecciÃ³n:

Radio buttons con direcciones guardadas del cliente
BotÃ³n "â• Agregar nueva direcciÃ³n"
Si nueva: formulario (calle, detalles, guardar)


Step 2 - MÃ©todo de pago:

Radio buttons: Efectivo | Transferencia | Tarjeta | Datafono


Step 3 - Confirmar:

Resumen completo: items, direcciÃ³n, pago, total
Textarea para comentarios adicionales
Checkbox "Acepto tÃ©rminos"
BotÃ³n "âœ… CONFIRMAR PEDIDO"



LÃ“GICA REQUERIDA:

Validar autenticaciÃ³n: si no hay customer_id, redirect a /login
Fetch direcciones guardadas: GET /api/customers/{id}/addresses
RE-VALIDAR horario al llegar a step 3
RE-VALIDAR productos activos al llegar a step 3
Al confirmar: POST /api/orders con:

  {
    customer_id, order_type: 'delivery',
    delivery_address, payment_method,
    items: [...cart con snapshot de precios],
    customer_notes
  }

Recibir: {order_number, total, estimated_time}
Limpiar CartContext
Navigate a /order-success?number={order_number}

src/pages/OrderSuccess.tsx
DEBE MOSTRAR:

âœ… Ãcono grande de Ã©xito
"Â¡Pedido confirmado!"
NÃºmero de pedido: PED-XXX (destacado)
Monto total
Tiempo estimado: XX minutos
"RecibirÃ¡s notificaciones en:"

âœ… Email
âœ… WhatsApp


BotÃ³n "Ver mis pedidos"
BotÃ³n "Volver al inicio"

src/pages/MyOrders.tsx
DEBE MOSTRAR:

Tabs: "Activos" | "Historial"
Activos: Lista de pedidos con status != 'completed'

Cada pedido: nÃºmero, fecha, total, status badge, botÃ³n "Ver detalle"
Status en tiempo real (WebSocket)


Historial: Lista paginada de pedidos completados
Filtros: fecha, monto

LÃ“GICA REQUERIDA:

Fetch pedidos activos: GET /api/orders?customer_id={id}&status=pending,confirmed,preparing,ready
Fetch historial: GET /api/orders?customer_id={id}&status=completed,cancelled&page={n}
Socket.IO: escuchar order-updated:{order_id} para actualizar status en tiempo real
Click pedido: navigate a /order/{id}

src/pages/OrderDetail.tsx
DEBE MOSTRAR:

NÃºmero de pedido
Timeline de estados:

â³ Pendiente â†’ âœ… Confirmado â†’ ğŸ³ Preparando â†’ ğŸ‰ Listo â†’ ğŸšš Entregado


Items del pedido con precios (snapshot)
Subtotal, domicilio, total
MÃ©todo de pago
DirecciÃ³n de entrega
Comentarios
BotÃ³n "ğŸ“ Contactar restaurante"

LÃ“GICA REQUERIDA:

Fetch detalle: GET /api/orders/{id}
Socket.IO: actualizar timeline en tiempo real

src/pages/Reservations.tsx â­ NUEVO
DEBE MOSTRAR:

Tabs: "PrÃ³ximas" | "Historial"
PrÃ³ximas: Lista de reservas con status='pending' o 'confirmed'

Cada reserva: cÃ³digo, fecha, hora, mesa, personas, status badge
BotÃ³n "Ver detalle" | "Cancelar" (si falta >2 horas)


Historial: Reservas completadas/canceladas
BotÃ³n flotante "â• Nueva Reserva"

LÃ“GICA REQUERIDA:

Fetch reservas: GET /api/reservations?customer_id={id}
Click "Nueva Reserva": navigate a /reservations/new
Cancelar reserva: DELETE /api/reservations/{id} (solo si falta >2h)

src/pages/NewReservation.tsx â­ NUEVO
DEBE MOSTRAR:

Step 1: Calendario para seleccionar fecha (deshabilitar pasadas)
Step 2: Selector de hora (intervalos de 30 min, solo horario del restaurante)
Step 3: Input nÃºmero de personas
Step 4: Mesas disponibles (grid de cards)

Cada mesa: nÃºmero, zona, capacidad, imagen
Highlight si capacidad == personas solicitadas


Step 5: Textarea solicitudes especiales
Step 6: Resumen completo + botÃ³n "Confirmar Reserva"

LÃ“GICA REQUERIDA:

Fetch horario restaurante: GET /api/schedules?day={selected_day}
Validar fecha futura
Validar hora dentro del horario del restaurante
Fetch mesas disponibles: GET /api/reservations/available-tables?date={date}&time={time}&party_size={n}
Al confirmar: POST /api/reservations con:

  {
    customer_id, table_id, reservation_date,
    reservation_time, party_size, special_requests
  }

Recibir: {reservation_number, status: 'pending'}
Mostrar mensaje: "Reserva creada. Te contactaremos para confirmar."
Navigate a /reservations

src/pages/Profile.tsx
DEBE MOSTRAR:

Avatar + nombre del cliente
Email
TelÃ©fono
Direcciones guardadas (lista, max 3)

BotÃ³n "âœï¸ Editar" | "ğŸ—‘ï¸ Eliminar"
BotÃ³n "â• Agregar" (si tiene <3)


EstadÃ­sticas:

Total de pedidos: XX
Total gastado: $XXX.XXX
Pedido promedio: $XX.XXX


BotÃ³n "Cerrar sesiÃ³n"

LÃ“GICA REQUERIDA:

Fetch datos: GET /api/customers/{id}
Editar perfil: PATCH /api/customers/{id}
Agregar direcciÃ³n: POST /api/customers/{id}/addresses
Eliminar direcciÃ³n: DELETE /api/customers/{id}/addresses/{index}
Cerrar sesiÃ³n: limpiar localStorage + AuthContext

src/components/Header.tsx
DEBE MOSTRAR:

Logo del restaurante (click â†’ home)
TÃ­tulo
Ãconos: ğŸ›’ Carrito (badge con cantidad) | ğŸ‘¤ Perfil
Responsive: hamburger menu en mÃ³vil

src/components/BottomNav.tsx
DEBE MOSTRAR:

Fixed bottom en mÃ³vil
4 tabs: ğŸ  Home | ğŸ• MenÃº | ğŸª‘ Reservas | ğŸ‘¤ Perfil
Active state visual

src/components/ProductCard.tsx
DEBE MOSTRAR:

Imagen producto (lazy load)
Badge "Agotado" si inactive
Nombre
DescripciÃ³n corta (max 60 chars)
Precio + domicilio
Rating
BotÃ³n "+"

src/context/AuthContext.tsx
DEBE IMPLEMENTAR:

Estado: {isAuthenticated, customer, token}
Funciones: login(phone, password), logout(), register(data)
Persistir en localStorage
Auto-refresh token cada 6h

src/context/CartContext.tsx
DEBE IMPLEMENTAR:

Estado: {items: [{menu_item_id, name, quantity, unit_price, item_delivery_cost, special_instructions}]}
Funciones: addItem(), removeItem(), updateQuantity(), clearCart()
Calcular: subtotal, deliveryCost (MAX), total
Persistir en localStorage

src/services/api.ts
DEBE EXPORTAR:

Funciones para TODOS los endpoints:

fetchSchedule()
fetchCategories()
fetchProducts(filters)
fetchProduct(id)
createOrder(data)
fetchOrders(customerId)
fetchReservations(customerId)
createReservation(data)
cancelReservation(id)
etc.


Configurar axios con baseURL
Interceptor para agregar token JWT en headers
Manejo de errores centralizado

src/hooks/useSocket.ts
DEBE IMPLEMENTAR:

Conectar a WebSocket al montar
Escuchar eventos: order-updated, reservation-confirmed
Retornar: {socket, isConnected}
Desconectar al desmontar

public/manifest.json
DEBE CONTENER:

name: "Restaurante - Pedidos"
short_name: "Restaurante"
icons: [192x192, 512x512]
start_url: "/"
display: "standalone"
theme_color: color primario
background_color: "#ffffff"

public/service-worker.js
DEBE IMPLEMENTAR:

Cache de assets estÃ¡ticos (CSS, JS, imÃ¡genes)
Cache de imÃ¡genes de productos
Network-first para API calls
Offline fallback page
Push notifications listener


3ï¸âƒ£ PWA MESERO (React + TypeScript)
ğŸ“ UbicaciÃ³n: /opt/restaurante-erp/pwa-mesero/
PÃ¡ginas a implementar:
src/pages/Login.tsx
DEBE MOSTRAR:

Logo del restaurante
TÃ­tulo "Acceso Meseros"
Input de PIN (4 dÃ­gitos, tipo password)
Teclado numÃ©rico visual (0-9)
BotÃ³n "Ingresar"
Mensaje de error si PIN incorrecto

LÃ“GICA REQUERIDA:

POST a /api/waiters/login con {pin_code}
Recibir: {token, waiter: {id, name, code}}
Guardar token + waiter en localStorage
Navigate a /tables

src/pages/Tables.tsx
DEBE MOSTRAR:

Header: nombre mesero, botÃ³n cerrar sesiÃ³n
Filtro por zona (dropdown): Todas | SalÃ³n | Terraza | VIP
Grid de mesas (responsive)
Cada mesa:

Card con nÃºmero/nombre
Ãcono segÃºn status:

ğŸŸ¢ Disponible
ğŸ”´ Ocupada (mostrar pedido actual)
ğŸŸ¡ Reservada (mostrar nombre cliente)
âš« Limpiando


Capacidad: "4 personas"
Si ocupada: monto acumulado "$XX.XXX"
BotÃ³n de acciÃ³n segÃºn estado


Bottom nav: ğŸª‘ Mesas | ğŸ“‹ Pedidos | ğŸª‘ Reservas | ğŸ“Š Stats

LÃ“GICA REQUERIDA:

Fetch mesas: GET /api/waiters/tables?waiter_id={id}
WebSocket: escuchar table-updated:{table_id} para actualizar en tiempo real
Filtrar por zona localmente
Click mesa disponible: modal con botÃ³n "Ocupar y Tomar Pedido"
Click mesa ocupada: navigate a /order/{current_order_id}
Click mesa reservada: navigate a /reservation/{current_reservation_id}

src/pages/NewOrder.tsx
DEBE MOSTRAR:

Header: "Mesa X - Nuevo Pedido" | âŒ Salir
Barra de bÃºsqueda de productos
Tabs de categorÃ­as (scroll horizontal)
Grid de productos (solo activos)
Pedido Actual (sidebar o secciÃ³n inferior):

Lista de items agregados
Cada item: nombre, cantidad, precio, subtotal, notas
Botones: âœï¸ Editar | ğŸ—‘ï¸ Eliminar


Resumen:

Subtotal: $XX.XXX
Propina sugerida 10%: $X.XXX
Total: $XX.XXX


Botones: "â• Agregar MÃ¡s" | "âœ… Enviar a Cocina"

LÃ“GICA REQUERIDA:

Recibir table_id desde params
Fetch productos activos: GET /api/menu/items?status=active
Click producto: modal para cantidad + notas especiales
Agregar a estado local del pedido
Al enviar: POST /api/orders con:

  {
    customer_id: null, // Mesero lo crea
    waiter_id: {current_waiter},
    table_id: {table_id},
    order_type: 'dine_in',
    items: [...]
  }

Recibir confirmaciÃ³n
Navigate a /tables

src/pages/ActiveOrders.tsx
DEBE MOSTRAR:

Filtros: Todas | Mis pedidos | Listos
Lista de pedidos activos con:

Mesa o "Domicilio"
NÃºmero de pedido
Items del pedido con status:

â³ Pendiente cocina
ğŸ³ En preparaciÃ³n
âœ… Listo


Tiempo transcurrido
Total


NotificaciÃ³n destacada cuando un item estÃ¡ listo

LÃ“GICA REQUERIDA:

Fetch pedidos: GET /api/waiters/orders?waiter_id={id}&status=confirmed,preparing,ready
WebSocket: escuchar order-item-ready:{order_item_id} para mostrar notificaciÃ³n
Click pedido: navigate a /order/{id}
BotÃ³n "Marcar como Servido" cuando todos items listos

src/pages/Reservations.tsx â­ NUEVO
DEBE MOSTRAR:

TÃ­tulo: "Reservas de Hoy - {fecha}"
Filtros: Todas | Confirmadas | Pendientes
SecciÃ³n CONFIRMADAS:

Lista de cards con:

ğŸ• Hora | Mesa X (Zona)
CÃ³digo: RES-XXX
ğŸ‘¤ Nombre cliente
ğŸ“ TelÃ©fono (click para llamar)
ğŸ‘¥ NÃºmero de personas
ğŸ“ Solicitudes especiales
â° "Libera automÃ¡tico: HH:MM"
BotÃ³n grande: "âœ… CLIENTE LLEGÃ“"




SecciÃ³n PENDIENTES:

Similar pero con badge "â³ Esperando confirmaciÃ³n admin"
Sin botÃ³n de acciÃ³n (solo admin puede confirmar)


Alerta 15 min antes:

NotificaciÃ³n push/modal: "Reserva prÃ³xima: Mesa X a las HH:MM"



LÃ“GICA REQUERIDA:

Fetch reservas del dÃ­a: GET /api/reservations?date={today}&status=confirmed,pending
Click "CLIENTE LLEGÃ“": PATCH /api/reservations/{id}/activate

Backend actualiza: status='active', table.status='occupied'


NotificaciÃ³n 15 min antes: comparar reservation_time con hora actual cada minuto
Click telÃ©fono: tel:{phone}

src/pages/Stats.tsx
DEBE MOSTRAR:

TÃ­tulo: "Mi DesempeÃ±o Hoy"
Cards con mÃ©tricas:

ğŸ’° Ventas: $XXX.XXX
ğŸ“‹ Pedidos atendidos: XX
ğŸª‘ Mesas atendidas: XX
ğŸ’µ Propinas: $XX.XXX


GrÃ¡fico de ventas por hora (barras)
Lista de Ãºltimos 10 pedidos

LÃ“GICA REQUERIDA:

Fetch stats: GET /api/waiters/{id}/stats?date={today}


4ï¸âƒ£ PWA COCINA (React + TypeScript)
ğŸ“ UbicaciÃ³n: /opt/restaurante-erp/pwa-cocina/
PÃ¡gina Ãºnica (fullscreen):
src/pages/Kitchen.tsx
DEBE MOSTRAR:

Header fijo:

Logo + "ğŸ§‘â€ğŸ³ COCINA"
Reloj en tiempo real
Contadores: ğŸŸ¡ Cola: X | ğŸŸ  Preparando: X | ğŸŸ¢ Listos: X
BotÃ³n ğŸ”„ Refresh manual


Filtros:

Botones toggle: Todas | ğŸ¥© Parrilla | ğŸŸ Fritos | ğŸ• Horno | ğŸº Bar | ğŸ¥— Ensaladas


SecciÃ³n URGENTE (roja):

Pedidos con +30 min de espera
Card destacada con animaciÃ³n de alerta


SecciÃ³n EN COLA (amarilla):

Cards de items pendientes
Ordenados por prioridad (automÃ¡tica del backend)
Cada card:

CÃ³digo pedido | Tipo (Mesa X, Domicilio, Para Llevar)
â±ï¸ Tiempo esperando
Items del pedido:

Nombre producto x Cantidad
ğŸ¥© EstaciÃ³n
ğŸ“ Notas especiales
â±ï¸ Tiempo estimado


BotÃ³n: "â–¶ï¸ INICIAR PREPARACIÃ“N"




SecciÃ³n EN PREPARACIÃ“N (naranja):

Cards similares pero con:

Timer visual (barra de progreso)
Hora de inicio
Tiempo restante estimado
BotÃ³n: "âœ… MARCAR LISTO"




SecciÃ³n LISTOS (verde):

Cards con:

âœ… Ãcono de completado
Hace cuÃ¡nto estÃ¡ listo
"ğŸ“¢ Mesero notificado" o "ğŸ“¢ Cliente notificado"




Alerta sonora:

Sonido al recibir nuevo pedido
NotificaciÃ³n visual (flash en header)



LÃ“GICA REQUERIDA:

Fetch cola: GET /api/kitchen/queue?station={filter}
WebSocket: escuchar new-kitchen-item:{item_id} para agregar en tiempo real
Auto-refresh cada 30 segundos
Click "INICIAR": POST /api/kitchen/{item_id}/start

Backend: status='preparing', started_at=NOW()
Mover card a secciÃ³n "En PreparaciÃ³n"
Iniciar timer visual


Click "MARCAR LISTO": POST /api/kitchen/{item_id}/complete

Backend: status='ready', completed_at=NOW()
EnvÃ­a notificaciÃ³n a mesero/cliente
Mover card a secciÃ³n "Listos"


Filtro por estaciÃ³n: filtrar localmente los items
Timer: calcular elapsed time cada segundo con setInterval
Prioridad visual: items urgentes con borde rojo grueso

src/components/KitchenCard.tsx
PROPS:

item: KitchenQueueItem
onStart: () => void
onComplete: () => void

DEBE MOSTRAR:

Toda la info del item segÃºn status
Adaptarse visualmente al status (colores, botones)

5ï¸âƒ£ PWA ADMIN (Next.js + TypeScript)
ğŸ“ UbicaciÃ³n: /opt/restaurante-erp/pwa-admin/
Layout principal:
app/layout.tsx
DEBE CONTENER:

Sidebar fijo (izquierda, colapsable en mÃ³vil)
MenÃº de navegaciÃ³n:

ğŸ“Š Dashboard
ğŸ½ï¸ MenÃº â†’ CategorÃ­as, SubcategorÃ­as, Productos
ğŸ“¦ Pedidos
ğŸ‘¥ Clientes
ğŸª‘ Reservas â†’ Lista, Calendario, ConfiguraciÃ³n
ğŸ‘¨â€ğŸ³ Personal
ğŸª‘ Mesas
â° Horarios
ğŸ“Š Reportes
ğŸ”” Notificaciones
âš™ï¸ ConfiguraciÃ³n


Header con: Logo, nombre admin, notificaciones, perfil

PÃ¡ginas a implementar:
app/dashboard/page.tsx
DEBE MOSTRAR:

MÃ©tricas (cards grandes):

ğŸ’° Ventas Hoy: $XXX.XXX (vs ayer: +X%)
ğŸ“¦ Pedidos Activos: XX
ğŸª‘ Mesas Ocupadas: X/15
ğŸ‘¥ Clientes Nuevos Hoy: XX
ğŸª‘ Reservas Hoy: XX (pendientes: X)


GrÃ¡fico ventas por hora (hoy):

Line chart con Recharts
Eje X: horas, Eje Y: monto


Top 5 productos mÃ¡s vendidos:

Lista con: imagen mini, nombre, unidades, ingresos


**Pedidos recientes (
ReintentarDContinuarÃºltimos 10):**

Tabla con: nÃºmero, tipo, mesa/cliente, monto, status
Click â†’ ir a detalle
Alertas:

ğŸ”´ X pedidos con +30 min
ğŸŸ¡ X reservas pendientes de confirmar
âš ï¸ X productos con stock bajo (si aplica)


ActualizaciÃ³n en tiempo real:

WebSocket para mÃ©tricas



LÃ“GICA REQUERIDA:

Fetch dashboard data: GET /api/admin/dashboard?date={today}
WebSocket: escuchar eventos y actualizar mÃ©tricas

app/menu/categories/page.tsx
DEBE MOSTRAR:

Header: "CategorÃ­as del MenÃº" | BotÃ³n "â• Nueva CategorÃ­a"
Tabla con:

Imagen (thumbnail)
Nombre
Orden
Estado (toggle switch activo/inactivo)
Acciones: âœï¸ Editar | ğŸ—‘ï¸ Eliminar


Drag & drop para reordenar (actualiza display_order)

LÃ“GICA REQUERIDA:

Fetch categorÃ­as: GET /api/admin/menu/categories
Crear: Modal con formulario â†’ POST /api/admin/menu/categories

Campos: nombre, subir imagen, display_order


Editar: Modal prellenado â†’ PATCH /api/admin/menu/categories/{id}
Eliminar: ConfirmaciÃ³n â†’ DELETE /api/admin/menu/categories/{id} (soft delete)
Toggle activo: PATCH /api/admin/menu/categories/{id} con {is_active}
Reordenar: PATCH /api/admin/menu/categories/reorder con [{id, display_order}]

app/menu/subcategories/page.tsx
SIMILAR A CATEGORÃAS pero:

Agregar columna "CategorÃ­a Padre" (dropdown filtro)
Al crear/editar: selector de categorÃ­a padre

app/menu/products/page.tsx
DEBE MOSTRAR:

Filtros: CategorÃ­a, SubcategorÃ­a, Estado (activo/inactivo)
Buscador por nombre
BotÃ³n "â• Nuevo Producto"
Tabla con:

Imagen
CÃ³digo (MENU-XXX)
Nombre
CategorÃ­a / SubcategorÃ­a
Precio
Domicilio
EstaciÃ³n
Estado (toggle)
Acciones: âœï¸ | ğŸ—‘ï¸ | ğŸ“¸ Cambiar foto


PaginaciÃ³n
Acciones masivas: Checkboxes + dropdown "Activar/Desactivar seleccionados"

LÃ“GICA REQUERIDA:

Fetch productos: GET /api/admin/menu/items?filters
Crear: Modal/pÃ¡gina con formulario completo â†’ POST /api/admin/menu/items

Campos: nombre, descripciÃ³n, precio, delivery_cost, preparation_time, subir imagen, categorÃ­a, subcategorÃ­a, estaciÃ³n, status
Generar menu_code automÃ¡tico


Editar: Similar
Eliminar: Soft delete
Toggle estado: actualiza status='active'/'inactive'
Cambiar foto: PATCH /api/admin/menu/items/{id}/image con FormData
Operaciones masivas: PATCH /api/admin/menu/items/bulk con {ids: [], action: 'activate'}

app/orders/page.tsx
DEBE MOSTRAR:

Filtros avanzados:

Fecha: Hoy, Ayer, Semana, Mes, Rango personalizado
Estado: Todos, Pendientes, Confirmados, En PreparaciÃ³n, Listos, Entregados, Cancelados
Tipo: Todos, Delivery, Dine-in, Takeout
Mesero: Todos, {lista de meseros}
MÃ©todo de pago: Todos, Efectivo, Tarjeta, Transferencia


Buscador: por nÃºmero de pedido, nombre cliente, telÃ©fono
Tabla con:

NÃºmero pedido (PED-XXX)
Fecha y hora
Tipo (badge con Ã­cono)
Cliente / Mesa
Mesero (si aplica)
Total
Estado (badge colorido)
Acciones: ğŸ‘ï¸ Ver | âœï¸ Editar Status | âŒ Cancelar


PaginaciÃ³n
Exportar: botÃ³n "ğŸ“¥ Exportar a Excel"

LÃ“GICA REQUERIDA:

Fetch pedidos: GET /api/admin/orders?filters&page={n}
Click "Ver": navigate a /orders/{id}
Cambiar status: Modal con dropdown â†’ PATCH /api/admin/orders/{id}/status
Cancelar: ConfirmaciÃ³n con razÃ³n â†’ PATCH /api/admin/orders/{id}/cancel
Exportar: GET /api/admin/orders/export?format=xlsx&filters â†’ descargar archivo

app/orders/[id]/page.tsx
DEBE MOSTRAR:

Header: NÃºmero pedido | Estado badge | Botones: âœï¸ Editar | ğŸ“ Llamar Cliente | ğŸ“„ Imprimir
InformaciÃ³n General:

Fecha y hora creaciÃ³n
Tipo de pedido
Cliente: nombre, telÃ©fono (click para llamar), email
DirecciÃ³n (si delivery)
Mesa (si dine-in)
Mesero asignado


Timeline de Estados:

Barra visual con checkpoints:

â³ Creado: {timestamp}
âœ… Confirmado: {timestamp}
ğŸ³ En PreparaciÃ³n: {timestamp}
ğŸ‰ Listo: {timestamp}
ğŸšš Entregado: {timestamp}




Items del Pedido:

Tabla con: producto, cantidad, precio unitario (snapshot), subtotal, notas especiales, status


Resumen Financiero:

Subtotal: $XX.XXX
Domicilio: $X.XXX
Total: $XX.XXX
MÃ©todo de pago


Comentarios del cliente:

Textarea con las notas


Acciones:

Dropdown "Cambiar Estado"
BotÃ³n "Reimprimir Ticket"
BotÃ³n "Enviar Comprobante por Email"



LÃ“GICA REQUERIDA:

Fetch detalle: GET /api/admin/orders/{id}
Cambiar estado: PATCH /api/admin/orders/{id}/status
Reimprimir: abrir modal con ticket HTML
Enviar email: POST /api/admin/orders/{id}/send-receipt

app/reservations/page.tsx â­ NUEVO
DEBE MOSTRAR:

Tabs: "Todas" | "Pendientes" | "Confirmadas" | "Activas" | "Historial"
Filtros: Fecha, Mesa, Cliente (bÃºsqueda)
BotÃ³n "â• Nueva Reserva Manual"
Tabla con columnas:

CÃ³digo (RES-XXX)
Fecha y Hora
Cliente (nombre, telÃ©fono)
Mesa
Personas
Estado (badge)
Acciones segÃºn estado:

Pendientes: âœ… Confirmar | âŒ Rechazar | âœï¸ Editar
Confirmadas: âœï¸ Editar | âŒ Cancelar | ğŸ“ Llamar
Activas: âœ… Completar
Historial: ğŸ‘ï¸ Ver




Click fila: abrir modal con detalle completo

LÃ“GICA REQUERIDA:

Fetch reservas: GET /api/admin/reservations?filters
Crear manual: Modal con formulario â†’ POST /api/admin/reservations

Buscar cliente existente o crear nuevo
Seleccionar fecha, hora, mesa disponible, personas
Status: 'confirmed' directo


Confirmar: PATCH /api/admin/reservations/{id}/confirm

EnvÃ­a notificaciÃ³n al cliente


Rechazar: Modal para razÃ³n â†’ PATCH /api/admin/reservations/{id}/reject
Editar: Modal â†’ PATCH /api/admin/reservations/{id}

Validar nueva mesa disponible
Notificar cliente de cambios


Cancelar: ConfirmaciÃ³n + razÃ³n â†’ PATCH /api/admin/reservations/{id}/cancel
Completar: PATCH /api/admin/reservations/{id}/complete

app/reservations/calendar/page.tsx â­ NUEVO
DEBE MOSTRAR:

Vista de calendario mensual (librerÃ­a react-calendar o similar)
Cada dÃ­a muestra: nÃºmero de reservas
Color coding:

ğŸŸ¢ DÃ­as con disponibilidad
ğŸŸ¡ DÃ­as con alta ocupaciÃ³n
ğŸ”´ DÃ­as sin disponibilidad


Click en dÃ­a: modal/panel lateral con:

Lista de reservas de ese dÃ­a
Timeline por hora mostrando mesas reservadas
BotÃ³n "Crear Reserva" para ese dÃ­a



LÃ“GICA REQUERIDA:

Fetch reservas del mes: GET /api/admin/reservations?month={YYYY-MM}
Click dÃ­a: fetch reservas del dÃ­a especÃ­fico

app/customers/page.tsx
DEBE MOSTRAR:

Buscador: por nombre, telÃ©fono, cÃ³digo
Filtros: Activos/Inactivos, Segmento (VIP, Frecuentes, Nuevos, Inactivos)
Tabla con:

CÃ³digo (CLI-XXX)
Nombre
TelÃ©fono
Email
Total pedidos
Total gastado
Ãšltima compra (hace X dÃ­as)
Estado (toggle)
Acciones: ğŸ‘ï¸ Ver | âœï¸ Editar | ğŸ“Š EstadÃ­sticas


BotÃ³n "ğŸ“¥ Exportar Base de Clientes"

LÃ“GICA REQUERIDA:

Fetch clientes: GET /api/admin/customers?filters&page={n}
Ver detalle: navigate a /customers/{id}
Editar: Modal
Exportar: descargar Excel

app/customers/[id]/page.tsx
DEBE MOSTRAR:

Header: CÃ³digo, nombre, botones: âœï¸ Editar | ğŸ“ Llamar | âœ‰ï¸ Email
InformaciÃ³n Personal:

Nombre completo
TelÃ©fono
Email
Estado (activo/inactivo)
Fecha de registro


Direcciones Guardadas:

Lista (mÃ¡x 3)
Botones: âœï¸ | ğŸ—‘ï¸ | â• Agregar


EstadÃ­sticas:

Total de pedidos: XX
Total gastado: $XXX.XXX (lifetime value)
Ticket promedio: $XX.XXX
Frecuencia: X pedidos/mes
Ãšltima compra: hace X dÃ­as


Productos Favoritos:

Top 5 productos mÃ¡s pedidos por este cliente


Historial de Pedidos:

Tabla completa paginada
Click â†’ ver detalle del pedido


Historial de Reservas:

Tabla con reservas pasadas


Notas Internas:

Textarea editable (solo admin)



LÃ“GICA REQUERIDA:

Fetch detalle: GET /api/admin/customers/{id}
Editar: inline o modal
Gestionar direcciones: CRUD

app/staff/page.tsx
DEBE MOSTRAR:

Lista de meseros
Tabla con:

CÃ³digo (MESERO-XXX)
Nombre
TelÃ©fono
Estado (activo/inactivo)
Pedidos hoy
Ventas hoy
Acciones: âœï¸ Editar | ğŸ”‘ Cambiar PIN | ğŸ—‘ï¸ Eliminar


BotÃ³n "â• Nuevo Mesero"

LÃ“GICA REQUERIDA:

Fetch meseros: GET /api/admin/waiters
Crear: Modal â†’ POST /api/admin/waiters

Campos: nombre, telÃ©fono, generar cÃ³digo automÃ¡tico
Crear PIN: input 4 dÃ­gitos â†’ hashear con bcrypt


Cambiar PIN: Modal â†’ PATCH /api/admin/waiters/{id}/pin

Nuevo PIN â†’ hashear


Editar/Eliminar: CRUD normal

app/tables/page.tsx
DEBE MOSTRAR:

Layout visual del restaurante (grid de cards por zona)
Filtro por zona
Cada mesa: card con nÃºmero, capacidad, zona, estado (color coding)
BotÃ³n "â• Agregar Mesa"
Click mesa: modal con detalle + opciones (editar, liberar, eliminar)

LÃ“GICA REQUERIDA:

Fetch mesas: GET /api/admin/tables
WebSocket: actualizar estados en tiempo real
CRUD de mesas
Liberar mesa: PATCH /api/admin/tables/{id}/release

app/schedules/page.tsx
DEBE MOSTRAR:

Tabla semanal:

Fila por cada dÃ­a (Lunes-Domingo)
Columnas: DÃ­a, Apertura, Cierre, Abierto/Cerrado (toggle), Nota


BotÃ³n "ğŸ’¾ Guardar Cambios"
SecciÃ³n "DÃ­as Especiales":

Agregar fechas especÃ­ficas con horario custom
Ejemplo: "25/12/2024: Cerrado - Navidad"



LÃ“GICA REQUERIDA:

Fetch horarios: GET /api/admin/schedules
Editar inline: time pickers
Guardar: PATCH /api/admin/schedules/bulk con array de cambios
Validar: cierre > apertura

app/reports/page.tsx
DEBE MOSTRAR:

Selector de tipo de reporte:

ğŸ“Š Ventas
ğŸ“¦ Productos
ğŸ‘¥ Clientes
ğŸ‘¨â€ğŸ³ Meseros
ğŸª‘ Mesas
ğŸª‘ Reservas
ğŸ’° Financiero


Filtros: perÃ­odo, comparativas
VisualizaciÃ³n:

GrÃ¡ficos (Recharts: barras, lÃ­neas, torta)
Tablas con datos
MÃ©tricas destacadas


BotÃ³n "ğŸ“¥ Exportar" (Excel/PDF)

LÃ“GICA REQUERIDA:

Fetch segÃºn tipo: GET /api/admin/reports/{type}?filters
Generar grÃ¡ficos con Recharts
Exportar: descargar archivo

app/notifications/page.tsx
DEBE MOSTRAR:

Log de notificaciones enviadas
Filtros: Tipo (Email, WhatsApp, Telegram), Estado (Enviado, Fallido), Fecha
Tabla con:

Timestamp
Tipo (badge)
Destinatario
Contenido (preview)
Estado
Error (si fallÃ³)
Acciones: ğŸ‘ï¸ Ver | ğŸ”„ Reenviar


SecciÃ³n "ConfiguraciÃ³n":

Editar templates de mensajes
Variables dinÃ¡micas disponibles: {{customer_name}}, {{order_number}}, etc.



LÃ“GICA REQUERIDA:

Fetch log: GET /api/admin/notifications?filters
Ver detalle: modal con contenido completo
Reenviar: POST /api/admin/notifications/{id}/resend
Editar templates: PATCH /api/admin/notifications/templates/{type}

app/settings/page.tsx
DEBE MOSTRAR:

Tabs:

General:

Nombre del restaurante
Subir logo
DirecciÃ³n, telÃ©fonos, email, redes sociales


MÃ©todos de Pago:

Toggles para activar/desactivar: Efectivo, Tarjeta, Transferencia, Datafono


Zonas de Entrega:

Lista de zonas con: nombre, costo domicilio, tiempo estimado
CRUD de zonas


PWA Config:

Color primario, secundario (color picker)
Habilitar/deshabilitar funciones: Domicilio, Para Llevar, Mesas, Reservas


Integraciones:

Evolution API: URL, API Key (test connection)
Telegram: Bot Token, Chat ID
SMTP: Host, Port, Usuario, Password


Reservas:

Tiempo de auto-liberaciÃ³n (dropdown: 15, 30, 45, 60 min)
Mesas disponibles online (checkboxes)
AnticipaciÃ³n mÃ­nima (horas)
AnticipaciÃ³n mÃ¡xima (dÃ­as)


Seguridad:

Cambiar contraseÃ±a admin
Ver log de actividad





LÃ“GICA REQUERIDA:

Fetch config: GET /api/admin/settings
Actualizar: PATCH /api/admin/settings/{section}
Test integraciÃ³n: POST /api/admin/settings/test/{service}


ğŸ”§ CONFIGURACIONES TÃ‰CNICAS COMUNES A TODOS LOS FRONTENDS
Variables de entorno (.env):
REACT_APP_API_URL=https://api.restaurante.com
REACT_APP_WS_URL=wss://api.restaurante.com
REACT_APP_DIRECTUS_URL=https://admin.restaurante.com
Axios config (todos los frontends):

BaseURL desde .env
Timeout: 30 segundos
Interceptor request: agregar token JWT en header Authorization: Bearer {token}
Interceptor response: catch 401 â†’ logout automÃ¡tico
Manejo de errores: toast con mensaje

Socket.IO config (Cliente, Mesero, Cocina, Admin):

Conectar al montar App
Namespaces:

Cliente: /customer
Mesero: /waiter
Cocina: /kitchen
Admin: /admin


Auth: enviar token en query params
Auto-reconnect: true
Eventos a escuchar (segÃºn rol)

Service Worker (PWA Cliente, Mesero, Cocina):

Cachear assets estÃ¡ticos (CSS, JS, fonts)
Cachear imÃ¡genes de productos (estrategia: Cache First)
API calls: Network First, fallback Cache
Offline page personalizada
Push notifications: pedir permiso al usuario, guardar subscription en backend

Validaciones frontend (todos):

TelÃ©fono: exactamente 10 dÃ­gitos, solo nÃºmeros
Email: regex estÃ¡ndar
PIN: exactamente 4 dÃ­gitos
Campos requeridos: mostrar asterisco rojo
ValidaciÃ³n en tiempo real (onBlur)
Mensajes de error claros en espaÃ±ol

Estilos (Tailwind):

Colores: definir paleta en tailwind.config.js

Primary: restaurante brand color
Secondary, accent, success, warning, error


Responsive: mobile-first approach
Dark mode: considerar si es necesario
Animaciones: usar transition-all duration-300

Manejo de errores:

Try-catch en todas las llamadas API
Toast notifications con biblioteca (react-hot-toast o similar)
Mensajes user-friendly en espaÃ±ol
Logs en consola solo en desarrollo

OptimizaciÃ³n:

Lazy loading de pÃ¡ginas (React.lazy + Suspense)
Lazy loading de imÃ¡genes (react-lazy-load-image o native)
Debounce en bÃºsquedas (300ms)
Throttle en scroll events
MemoizaciÃ³n de componentes pesados (React.memo)
useCallback y useMemo donde sea necesario

Testing (opcional pero recomendado):

Tests unitarios de componentes crÃ­ticos
Tests de integraciÃ³n de flujos principales
Tests E2E de flujo completo de pedido/reserva


âœ… CHECKLIST FINAL DE FUNCIONALIDAD
Widget Chat:

âœ… State machine 0-15 funcional
âœ… ValidaciÃ³n de horario en 3 puntos
âœ… RE-validaciÃ³n producto activo al agregar
âœ… Delivery cost = MAX calculado correctamente
âœ… Flujo de pedido completo
âœ… Flujo de reserva completo
âœ… Persistencia en localStorage
âœ… Formato de mensajes atractivo

PWA Cliente:

âœ… NavegaciÃ³n completa del menÃº
âœ… Carrito funcional con persistencia
âœ… Checkout completo con validaciones
âœ… Crear reserva online paso a paso
âœ… Ver mis pedidos en tiempo real
âœ… Ver mis reservas
âœ… Notificaciones push
âœ… Offline mode bÃ¡sico

PWA Mesero:

âœ… Login con PIN
âœ… GestiÃ³n de mesas en tiempo real
âœ… Tomar pedidos desde mesa
âœ… Ver reservas del dÃ­a
âœ… Activar reserva cuando cliente llega
âœ… Notificaciones de platos listos
âœ… EstadÃ­sticas personales

PWA Cocina:

âœ… Ver cola completa
âœ… Filtros por estaciÃ³n
âœ… Iniciar preparaciÃ³n (timer visual)
âœ… Marcar listo (notifica automÃ¡ticamente)
âœ… ActualizaciÃ³n en tiempo real
âœ… Alertas sonoras de nuevos pedidos
âœ… Modo fullscreen/kiosk

PWA Admin:

âœ… Dashboard con mÃ©tricas tiempo real
âœ… CRUD completo de menÃº (categorÃ­as, subcategorÃ­as, productos)
âœ… GestiÃ³n de imÃ¡genes
âœ… Activar/desactivar productos (efecto inmediato)
âœ… GestiÃ³n completa de pedidos
âœ… GestiÃ³n completa de reservas (confirmar, editar, cancelar)
âœ… Calendario de reservas visual
âœ… GestiÃ³n de clientes con estadÃ­sticas
âœ… GestiÃ³n de personal (meseros)
âœ… GestiÃ³n de mesas
âœ… ConfiguraciÃ³n de horarios
âœ… Reportes con grÃ¡ficos
âœ… Log de notificaciones
âœ… ConfiguraciÃ³n general del sistema
âœ… ExportaciÃ³n a Excel/PDF


ğŸ¯ PRIORIDAD DE IMPLEMENTACIÃ“N SUGERIDA:

PWA Admin (crear y configurar todo el menÃº primero)
Widget Chat (para que clientes puedan pedir)
PWA Cliente (experiencia mejorada para clientes)
PWA Cocina (para procesar los pedidos)
PWA Mesero (para pedidos presenciales y reservas)


FIN DE INSTRUCCIONES DE FRONTEND

